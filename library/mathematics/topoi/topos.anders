{- Topos:
   â€”Â Category, Pullback, Mono, Epi, Set, subobjectClassifier, CCC.
   â€”Â setSig, setPi, SET, Path.
   â€”Â Topos, Set Topos.
   
   http://www.ams.org/notices/200409/what-is-illusie.pdf

   Copyright Â© Groupoid Infinity, 2021â€”2022,
             Â© @siegment, 2022 -}

module topos where
import library/mathematics/categories/category
import library/mathematics/categories/functor

def epi (P : precategory) (X Y : P.C.ob) (f : P.C.hom X Y) : U :=
Î  (Z : P.C.ob) (g1 g2 : P.C.hom Y Z), Path (P.C.hom X Z) (P.P.âˆ˜ X Y Z f g1) (P.P.âˆ˜ X Y Z f g2) â†’ Path (P.C.hom Y Z) g1 g2

def mono (P : precategory) (Y Z : P.C.ob) (f : P.C.hom Y Z): U :=
Î  (X: P.C.ob) (g1 g2: P.C.hom X Y), Path (P.C.hom X Z) (P.P.âˆ˜ X Y Z g1 f) (P.P.âˆ˜ X Y Z g2 f) â†’ Path (P.C.hom X Y) g1 g2

def subobjectClassifier (C : precategory) : U :=
Î£ (omega : C.C.ob)
  (endâ€² : terminal C)
  (trueHom : C.C.hom endâ€².top omega)
  (xi : Î  (Y X : C.C.ob) (j : C.C.hom Y X), C.C.hom X omega)
  (square : Î  (Y X : C.C.ob) (j : C.C.hom Y X), mono C Y X j â†’ hasPullback C (omega, (endâ€².top, trueHom), (X, xi Y X j))),
  Î  (Y X : C.C.ob) (j : C.C.hom Y X) (k : C.C.hom X omega), (mono C Y X j) â†’
    (hasPullback C (omega, (endâ€².top, trueHom), (X, k))) â†’ (Path (C.C.hom X omega) (xi Y X j) k)

def isCCC (C : precategory) : U :=
Î£ (Exp : Î  (A B : C.C.ob), C.C.ob)
  (Prod : Î  (A B : C.C.ob), C.C.ob)
  (Apply : Î  (A B : C.C.ob), C.C.hom (Prod (Exp A B) A) B)
  (P1 : Î  (A B : C.C.ob), C.C.hom (Prod A B) A)
  (P2 : Î  (A B : C.C.ob), C.C.hom (Prod A B) B), terminal C

axiom ğ’®â„¯ğ“‰ : precategory
axiom cartesianClosed : isCCC ğ’®â„¯ğ“‰
axiom hasSubobject : subobjectClassifier ğ’®â„¯ğ“‰

def Topos (cat : precategory) : U := Î£ (cartesianClosed : isCCC cat), subobjectClassifier cat
def internal : Topos ğ’®â„¯ğ“‰ := (cartesianClosed, hasSubobject)
def presheaf (C : precategory) : U := catfunctor (catáµ’áµ– C) ğ’®â„¯ğ“‰
def Co (C : precategory) (cod : C.C.ob) : U := Î£ (dom : C.C.ob), C.C.hom dom cod
def Delta (C : precategory) (d : C.C.ob) : Uâ‚ := Î£ (index : U), index â†’ Co C d

def Coverage (C : precategory): Uâ‚ :=
Î£ (cod : C.C.ob) (fam : Delta C cod) (coverings : C.C.ob â†’ Delta C cod â†’ U), coverings cod fam

def site (C : precategory) : Uâ‚ := Î£ (C : precategory), Coverage C
def sheaf (C : precategory) : Uâ‚ := Î£ (S : site C), presheaf S.C
