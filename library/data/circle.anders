import library/data/iso
import library/data/bool
import library/data/coequalizer
import library/mathematics/constsquares

-- https://github.com/mortberg/cubicaltt/blob/master/examples/circle.ctt

def SÂ¹ : U := coeq (id ğŸ) (id ğŸ)
def base : SÂ¹ := iota (id ğŸ) (id ğŸ) â˜…
def loop : Path SÂ¹ base base := <i> resp (id ğŸ) (id ğŸ) â˜… i

def Î©Â¹SÂ¹ := Path SÂ¹ base base

section
  variables (B : SÂ¹ â†’ U) (b : B base) (â„“ : PathP (<i> B (loop @ i)) b b)

  def SÂ¹-ind-lem := indâ‚ (Î» (x : ğŸ), B (iota (id ğŸ) (id ğŸ) x)) b

  def SÂ¹-ind : Î  (x : SÂ¹), B x :=
  coeq-indâ€² ğŸ ğŸ (id ğŸ) (id ğŸ) B (SÂ¹-ind-lem B b â„“)
    (indâ‚ (Î» (x : ğŸ), PathP (<i> B (resp (id ğŸ) (id ğŸ) x i))
                            (SÂ¹-ind-lem B b â„“ x) (SÂ¹-ind-lem B b â„“ x)) â„“)
end

def SÂ¹-rec (B : U) : Î  (b : B) (â„“ : Path B b b), SÂ¹ â†’ B := SÂ¹-ind (Î» (_ : SÂ¹), B)

def rot := SÂ¹-ind (Î» (x : SÂ¹), Path SÂ¹ x x) loop (cs SÂ¹ base loop)
def mul (x : SÂ¹) : SÂ¹ â†’ SÂ¹ := SÂ¹-rec SÂ¹ x (rot x)
def square (x : SÂ¹) := mul x x

def double-loop (â„“ : Î©Â¹SÂ¹) : Î©Â¹SÂ¹ := <i> square (â„“ @ i)
def triple-loop (â„“ : Î©Â¹SÂ¹) : Î©Â¹SÂ¹ := <i> mul (â„“ @ i) (square (â„“ @ i))

def com-SÂ¹ : Î©Â¹SÂ¹ â†’ Î©Â¹SÂ¹ â†’ Î©Â¹SÂ¹ := comp-Path SÂ¹ base base base

def bool-neg-path : PathP (<_> U) ğŸ ğŸ :=
isoâ†’path ğŸ ğŸ neg neg neg-neg neg-neg

option girard true

def MÃ¶bius : SÂ¹ â†’ U :=
SÂ¹-ind (Î» (_ : SÂ¹), U) ğŸ bool-neg-path

def oddity (â„“ : Î©Â¹SÂ¹) : ğŸ :=
transp (<i> MÃ¶bius (â„“ @ i)) 0 0â‚‚

def oddity-test := oddity (double-loop loop)
