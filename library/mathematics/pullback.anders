{- Homotopy Pullback.
   HoTT 2.15

   Copyright Â© Groupoid Infinity, 2021â€”2022,
             Â© @siegment, 2022 -}

module pullback where
import library/data/path
import library/data/equiv

{-
       zâ‚‚
    Z â€•â€•â€•â€•â†’ B
    |       |
 zâ‚ |  pb   | g
    â†“       â†“
    A â€•â€•â€•â€•â†’ C
        f
-}

def pullback (A B C : U) (f : A â†’ C) (g : B â†’ C) : U := Î£ (a : A) (b : B), Path C (f a) (g b)
def kernel (A B : U) (f : A â†’ B) : U := pullback A A B f f
def hofiber (A B : U) (f : A â†’ B) (y : B): U := pullback A ğŸ B f (Î» (x : ğŸ), y)

section
  variables (A B C : U) (f : A â†’ C) (g : B â†’ C)

  def pbâ‚ : pullback A B C f g â†’ A := Î» (x : pullback A B C f g), x.1
  def pbâ‚‚ : pullback A B C f g â†’ B := Î» (x : pullback A B C f g), x.2.1
  def pbâ‚ƒ : Î  (x : pullback A B C f g), Path C (f x.1) (g x.2.1) := Î» (x : pullback A B C f g), x.2.2
end

def induced (Z A B C : U) (f : A â†’ C) (g : B â†’ C) (zâ‚ : Z â†’ A) (zâ‚‚ : Z â†’ B)
  (h : Î  (z : Z), Path C ((âˆ˜ Z A C f zâ‚) z) (((âˆ˜ Z B C g zâ‚‚)) z)) : Z â†’ pullback A B C f g :=
Î» (z : Z), (zâ‚ z, zâ‚‚ z, h z)

def pullbackSq (Z A B C : U) (f : A â†’ C) (g : B â†’ C) (zâ‚ : Z â†’ A) (zâ‚‚ : Z â†’ B): U :=
Î£ (h : Î  (z : Z), Path C ((âˆ˜ Z A C f zâ‚) z) (((âˆ˜ Z B C g zâ‚‚)) z)), isEquiv Z (pullback A B C f g) (induced Z A B C f g zâ‚ zâ‚‚ h)

def isPullbackSq (Z A B C : U) (f : A â†’ C) (g : B â†’ C)
  (zâ‚ : Z â†’ A) (zâ‚‚ : Z â†’ B) (h : Î  (z : Z), Path C ((âˆ˜ Z A C f zâ‚) z) (((âˆ˜ Z B C g zâ‚‚)) z)) : U :=
isEquiv Z (pullback A B C f g) (induced Z A B C f g zâ‚ zâ‚‚ h)